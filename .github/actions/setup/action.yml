name: Setup on Linux
description: Setup basic conda and Python environment on Linux

inputs:
  deploy_key:
    description: key to fetch the private dependencies
    required: true

runs:
  using: composite
  steps:
    - name: set path to dependencies
      id: set-dep-path
      run: |
        echo "::set-output name=dep-path::requirements/ci.txt"
      shell: bash
    - name: set up Python with cache
      uses: actions/setup-python@v4
      id: py
      with:
        python-version: '3.10'
        cache: 'pip'
        cache-dependency-path: ${{ steps.set-dep-path.outputs.dep-path }}
    - run: echo "cache hit ${{ steps.py.outputs.cache-hit }}"
      shell: bash
    - name: install dependencies
      run: |
        eval `ssh-agent -s`
        ssh-add - <<< '${{ inputs.deploy_key }}'
        pip install -r ${{ steps.set-dep-path.outputs.dep-path }}
        echo "PYTHONPATH=$PYTHONPATH:${GITHUB_WORKSPACE}" >> $GITHUB_ENV
      shell: bash
